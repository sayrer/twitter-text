# Linux: Skip macOS-only targets (rules_apple doesn't handle target_compatible_with properly)
build:linux --build_tag_filters=-macos_only
test:linux --test_tag_filters=-macos_only

# Set Ruby build environment for rules_ruby
# These environment variables are used by ruby-build during Ruby compilation
build --action_env=RUBY_CONFIGURE_OPTS="--disable-install-doc"

# macOS-specific settings for Homebrew
build:macos --action_env=CPPFLAGS="-I/opt/homebrew/include"
build:macos --action_env=LDFLAGS="-L/opt/homebrew/lib"
build:macos --action_env=RUBY=/opt/homebrew/opt/ruby@3.2/bin/ruby

# JDK
build --java_runtime_version=remote
build --java_language_version=23
build --tool_java_runtime_version=remote

# CI-Linux config: for BuildBuddy CI (uses host toolchain)
build:ci-linux --build_tag_filters=-macos_only
test:ci-linux  --test_tag_filters=-macos_only
build:ci-linux --bes_results_url=https://app.buildbuddy.io/invocation/
build:ci-linux --bes_backend=grpcs://remote.buildbuddy.io
build:ci-linux --remote_cache=grpcs://remote.buildbuddy.io
build:ci-linux --remote_upload_local_results
build:ci-linux --remote_timeout=10m
build:ci-linux --remote_cache_compression
build:ci-linux --extra_execution_platforms=//tools:linux_remote
build:ci-linux --host_platform=//tools:linux_remote
build:ci-linux --jobs=50
build:ci-linux --remote_executor=grpcs://remote.buildbuddy.io


# Linux config: for local development (uses hermetic LLVM)
build:linux --bes_results_url=https://app.buildbuddy.io/invocation/
build:linux --bes_backend=grpcs://remote.buildbuddy.io
build:linux --remote_cache=grpcs://remote.buildbuddy.io
build:linux --remote_upload_local_results
build:linux --remote_timeout=10m
build:linux --remote_executor=grpcs://remote.buildbuddy.io

#build:linux --bes_results_url=https://sayrer-ml.tailc4a62e.ts.net:8080/invocation/
#build:linux --bes_backend=grpcs://sayrer-ml.tailc4a62e.ts.net:1986
#build:linux --remote_cache=grpcs://sayrer-ml.tailc4a62e.ts.net:1986
#build:linux --remote_timeout=10m

build:linux --remote_cache_compression
build:linux --extra_execution_platforms=//tools:linux_remote
build:linux --host_platform=//tools:linux_remote
build:linux --experimental_disk_cache_gc_max_size=10G

#build:linux --spawn_strategy=docker --strategy=Javac=docker --genrule_strategy=docker
#build:linux --experimental_docker_verbose
#build:linux --experimental_enable_docker_sandbox
#build:linux --strategy=CopyFile=sandboxed,standalone
build:linux --jobs=50

## Force Ruby-related actions to run locally (hermetic Ruby doesn't support RBE)
#build:linux --strategy_regexp=.*ruby.*=local
#build:linux --strategy_regexp=.*Ruby.*=local
#build:linux --strategy_regexp=.*GemInstall.*=local
#build:linux --strategy_regexp=.*bundle.*=local

# Force Swift-related actions to run locally (CYaml module issues with RBE)
build:linux --strategy_regexp=.*Swift.*=local
build:linux --strategy_regexp=.*swift.*=local
build:linux --strategy_regexp=.*yams.*=local
build:linux --strategy_regexp=.*Yams.*=local
test:linux --strategy_regexp=.*Swift.*=local
test:linux --strategy_regexp=.*swift.*=local

# Hermetic execution uses hermetic LLVM
# build:hermetic --extra_toolchains=@llvm_toolchain//:all

try-import %workspace%/.auth.bazelrc
